/**
 * Extract the first valid JSON object from the response
 */
private function extractAndCompleteJson($content)
{
    // Find the first JSON object start
    $startPos = strpos($content, '{');
    if ($startPos === false) {
        return null;
    }
    
    // Extract from the first { onwards
    $jsonPart = substr($content, $startPos);
    
    // Find the first complete JSON object by counting braces
    $braceCount = 0;
    $length = strlen($jsonPart);
    
    for ($i = 0; $i < $length; $i++) {
        if ($jsonPart[$i] === '{') {
            $braceCount++;
        } elseif ($jsonPart[$i] === '}') {
            $braceCount--;
            if ($braceCount === 0) {
                // Found the first complete JSON object
                $firstJson = substr($jsonPart, 0, $i + 1);
                
                // Test if it's valid JSON
                $decoded = json_decode($firstJson, true);
                if (json_last_error() === JSON_ERROR_NONE) {
                    return $firstJson;
                }
            }
        }
    }
    
    return null;
}
